# Дипломная работа

Тема дипломной работы: Интеллектуальный помощник для работы с электронной библиотекой.

Архитектура программной системы - клиент-сервер.

По сути это приложение будет представлять собой менеджер PDF документов с читалкой книг с возможностью нахождения определения слов, переводом и обобщением текста.

В этом проекте используется следующий стек технологии:

- серверная часть - .NET, C#, фреймворк ASP.NET Core, ORM Entity Framework Core;
- клиентская часть - Angular 17, Angular Material, ngx-extended-pdf-viewer.

Для аутентификации используется JWT-токены. Для доступа к API используется access токен, которые имеет короткое время жизни.
Он не должен храниться в localStorage/sessionStorage.
Для обновления access токена используется refresh токен которые хранится в куки с `httpOnly` атрибутом, и клиентская часть не имеет доступа к refresh токену.

## Структура проекта
```
.
├── docs    // содержит пояснительную записку, схемы алгоритмов для ВКР
├── scripts // содержит PowerShell скрипты для сборки docker образа, скрипт преобразования C# классов в Typescript (используется dotnet пакет tapper)
├── src     // содержит C# проекты (projects); является серверной частью проекта
│   ├── Api
│   ├── Application
│   ├── Domain
│   └── Tests
├── web     // npm проект клиентской части приложения
├── README.md    
├── BLibMgr.sln  // файл C# Solution; является серверной частью проекта
├── compose.yaml // файл Docker Compose 
└── Dockerfile   // файл сборки ASP.NET Core приложения
```

## Архитектура сервера

Сервер имеет N-tier архитектуру. Состоит из следующих слоёв:
 - Слой контроллеров (проект `Api`).
 - Сервисный слой (проект `Application`).

Слой контроллеров обрабатывает HTTP(S) запросы и передаёт данные в виде объектов DTO классов сервисам.
Классы слоя контроллеров находятся в проекте `Api`.

В сервисном слое находится вся бизнес логика. Этот слой взаимодействует с СУБД через объект реализующий интерфейс `IAppDbContext`. Его реализует класс `AppDbContext`, наследуемый от класса `DbContext` из пакета Entity Framework.
Также сервисы содержат код взаимодействующая с файловой системой через интерфейс `IFileStorage` для хранения копии электронных книг и их превьюшек (thumbnails) в виде растрового изображения. 
Сервисный слой находится в проекте `Application`.
В проекте ещё содержится определения DTO классов, классы исключения, `*Options` классы для конфигурации в ASP.NET Core, классы для миграции базы данных, а также определения интерфейсов для сервисов.
Все классы-сервисы должны реализовывать эти интерфейсы. Проекты, которые будут работать с этими сервисами из проекта `Application`, желательно должны работать с интерфейсами сервисов.
Имеет зависимость от проекта `Domain`.

В проекте `Domain` содержатся классы и перечисления, связанные с предметной областью.

## Docker Compose

Для работы этой системы требуется:
 - сервисный аккаунт в Яндекс.Облако;
 - аккаунт разработчика в онлайн-словаре Merriam-Webster;
 - установленная СУБД PostgreSQL на хосте.
  
Также нужно определить переменные окружения:  
 - `DbUser` - имя пользователя в базе данных;
 - `DbPassword` - пароль пользователя в базе данных;
 - `KeysPath` - путь до директория с приватным ключом с именем `yc.pem` от сервисного аккаунта Яндекса (будет смонтирована);
 - `StoragePath` - путь до директория, где будут хранятся файлы книг (будет смонтирована);
 - `YandexCloud__KeyId` - идентификатор авторизованного ключа сервисного пользователя;
 - `YandexCloud__ServiceAccountId` - идентификатор сервисного пользователя;
 - `YandexCloud__FolderPath` - идентификатор папки на котором зарегистрирован платёжный аккаунт;
 - `MerriamWeb__ApiKey` - ключ API доступа к API MerriamWebster.

Переменные окружения можно задать в файле `.env` вместе с `compose.yaml`.

Имя базы данных заранее определено и является неизменяемым "libmgr".

Чтобы запустить приложение нужно ввести следующую команду:
Bash:
```bash
DbUser="<database_user>" DbPassword="<database_password>" StoragePath="<your_storage_path>" \ 
KeysPath="<private_certificate_directory>" docker compose up
```

## Ссылки

- Документация IAM системы Яндекс Cloud https://yandex.cloud/ru/docs/iam/concepts/
- Справочник файла Docker Compose - https://docs.docker.com/compose/compose-file/